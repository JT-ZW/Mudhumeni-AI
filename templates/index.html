<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Mudhumeni AI Chatbot - Your African Farming Guide</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Ubuntu:wght@300;400;500;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Mudhumeni AI - Your intelligent farming companion for Southern Africa"
    />
    <style>
      :root {
        /* African Earth-Inspired Color Palette */
        --primary-green: #2e7d32;
        --secondary-green: #4caf50;
        --accent-orange: #ff6f00;
        --warm-brown: #8d6e63;
        --earth-red: #a0522d;
        --golden-yellow: #ffc107;
        --soft-cream: #fff8e1;
        --light-sage: #e8f5e8;
        --deep-forest: #1b5e20;

        /* Background gradients */
        --bg-gradient: linear-gradient(135deg, #fff8e1 0%, #e8f5e8 100%);
        --chat-bg: rgba(255, 255, 255, 0.95);
        --user-msg-bg: linear-gradient(135deg, #2e7d32 0%, #4caf50 100%);
        --bot-msg-bg: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);

        /* Typography */
        --font-primary: "Ubuntu", sans-serif;
        --font-secondary: "Inter", sans-serif;

        /* Shadows and effects */
        --shadow-soft: 0 8px 32px rgba(0, 0, 0, 0.1);
        --shadow-medium: 0 12px 40px rgba(0, 0, 0, 0.15);
        --border-radius: 20px;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: var(--font-primary);
        background: var(--bg-gradient);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 120px 20px 20px;
        position: relative;
        overflow-x: hidden;
      }

      /* African Pattern Background */
      body::before {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: radial-gradient(
            circle at 20% 80%,
            rgba(255, 111, 0, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 20%,
            rgba(46, 125, 50, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 40% 40%,
            rgba(255, 193, 7, 0.05) 0%,
            transparent 50%
          );
        z-index: -2;
      }

      /* Traditional African Pattern Overlay */
      body::after {
        content: "";
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-image: linear-gradient(
            45deg,
            transparent 40%,
            rgba(141, 110, 99, 0.02) 50%,
            transparent 60%
          ),
          linear-gradient(
            -45deg,
            transparent 40%,
            rgba(141, 110, 99, 0.02) 50%,
            transparent 60%
          );
        background-size: 40px 40px;
        z-index: -1;
      }

      /* Navigation Bar */
      .nav-bar {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        padding: 1rem 2rem;
        box-shadow: var(--shadow-soft);
        z-index: 1000;
        display: flex;
        justify-content: space-between;
        align-items: center;
        border-bottom: 1px solid rgba(46, 125, 50, 0.1);
      }

      .nav-logo {
        font-size: 1.8rem;
        font-weight: 700;
        color: var(--primary-green);
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .nav-logo i {
        color: var(--accent-orange);
      }

      .nav-links {
        display: flex;
        gap: 2rem;
        align-items: center;
      }

      .nav-links a {
        color: var(--primary-green);
        text-decoration: none;
        font-weight: 500;
        font-family: var(--font-secondary);
        transition: all 0.3s ease;
        padding: 8px 16px;
        border-radius: 12px;
      }

      .nav-links a:hover {
        background: var(--light-sage);
        transform: translateY(-2px);
      }

      .nav-links a.active {
        background: var(--primary-green);
        color: white;
      }

      /* Main Chat Container */
      #chat-container {
        width: 100%;
        max-width: 1200px;
        height: 85vh;
        background: var(--chat-bg);
        backdrop-filter: blur(20px);
        border-radius: var(--border-radius);
        box-shadow: var(--shadow-medium);
        display: flex;
        flex-direction: column;
        overflow: hidden;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      /* Header */
      .chat-header {
        background: var(--user-msg-bg);
        padding: 2rem;
        display: flex;
        align-items: center;
        gap: 20px;
        position: relative;
      }

      .chat-header::before {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-image: radial-gradient(
            circle at 20% 20%,
            rgba(255, 255, 255, 0.1) 0%,
            transparent 50%
          ),
          radial-gradient(
            circle at 80% 80%,
            rgba(255, 255, 255, 0.05) 0%,
            transparent 50%
          );
      }

      .bot-avatar {
        width: 60px;
        height: 60px;
        background: rgba(255, 255, 255, 0.2);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.5rem;
        color: white;
        border: 3px solid rgba(255, 255, 255, 0.3);
        position: relative;
        z-index: 1;
      }

      .header-content {
        color: white;
        position: relative;
        z-index: 1;
      }

      .header-title {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 5px;
      }

      .header-subtitle {
        font-size: 1rem;
        opacity: 0.9;
        font-family: var(--font-secondary);
      }

      .status-indicator {
        margin-left: auto;
        display: flex;
        align-items: center;
        gap: 8px;
        color: white;
        font-family: var(--font-secondary);
        position: relative;
        z-index: 1;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        background: var(--golden-yellow);
        border-radius: 50%;
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      /* Chat History */
      #chat-history {
        flex-grow: 1;
        padding: 2rem;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        background: transparent;
        scroll-behavior: smooth;
      }

      #chat-history::-webkit-scrollbar {
        width: 6px;
      }

      #chat-history::-webkit-scrollbar-track {
        background: rgba(0, 0, 0, 0.05);
        border-radius: 10px;
      }

      #chat-history::-webkit-scrollbar-thumb {
        background: var(--primary-green);
        border-radius: 10px;
      }

      /* Message Styles */
      .message {
        display: flex;
        align-items: flex-start;
        gap: 15px;
        max-width: 85%;
        animation: slideIn 0.4s ease-out;
      }

      .message.user {
        margin-left: auto;
        flex-direction: row-reverse;
      }

      @keyframes slideIn {
        from {
          opacity: 0;
          transform: translateY(20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .message-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.1rem;
        flex-shrink: 0;
        margin-top: 4px;
      }

      .user .message-avatar {
        background: var(--user-msg-bg);
        color: white;
        border: 2px solid rgba(46, 125, 50, 0.3);
      }

      .assistant .message-avatar {
        background: var(--bot-msg-bg);
        color: var(--primary-green);
        border: 2px solid rgba(46, 125, 50, 0.2);
      }

      .message-content {
        padding: 1.2rem 1.5rem;
        border-radius: 18px;
        box-shadow: var(--shadow-soft);
        line-height: 1.6;
        font-family: var(--font-secondary);
        position: relative;
        max-width: 100%;
        word-wrap: break-word;
      }

      .user .message-content {
        background: var(--user-msg-bg);
        color: white;
        border-bottom-right-radius: 6px;
      }

      .assistant .message-content {
        background: var(--bot-msg-bg);
        color: var(--primary-green);
        border-bottom-left-radius: 6px;
        border: 1px solid rgba(46, 125, 50, 0.1);
      }

      /* Enhanced Markdown Styling for Bot Messages */
      .assistant .message-content h1,
      .assistant .message-content h2,
      .assistant .message-content h3 {
        color: var(--deep-forest);
        margin: 1rem 0 0.5rem;
        font-weight: 600;
      }

      .assistant .message-content h3 {
        font-size: 1.1rem;
        border-bottom: 2px solid var(--accent-orange);
        padding-bottom: 4px;
        display: inline-block;
      }

      .assistant .message-content p {
        margin: 0.75rem 0;
        line-height: 1.7;
      }

      .assistant .message-content strong {
        color: var(--deep-forest);
        font-weight: 600;
      }

      .assistant .message-content ul,
      .assistant .message-content ol {
        margin: 1rem 0;
        padding-left: 1.5rem;
      }

      .assistant .message-content li {
        margin: 0.5rem 0;
        line-height: 1.6;
      }

      .assistant .message-content li::marker {
        color: var(--accent-orange);
      }

      .assistant .message-content blockquote {
        border-left: 4px solid var(--accent-orange);
        padding-left: 1rem;
        margin: 1rem 0;
        font-style: italic;
        background: rgba(255, 111, 0, 0.05);
        padding: 0.75rem 1rem;
        border-radius: 8px;
      }

      .assistant .message-content code {
        background: rgba(46, 125, 50, 0.1);
        padding: 2px 6px;
        border-radius: 4px;
        font-family: "Courier New", monospace;
        font-size: 0.9rem;
      }

      /* Typing Indicator */
      .typing-indicator {
        display: none;
        align-items: center;
        gap: 15px;
        max-width: 85%;
        animation: slideIn 0.4s ease-out;
      }

      .typing-content {
        padding: 1rem 1.5rem;
        background: var(--bot-msg-bg);
        border-radius: 18px;
        border-bottom-left-radius: 6px;
        box-shadow: var(--shadow-soft);
        display: flex;
        align-items: center;
        gap: 8px;
        border: 1px solid rgba(46, 125, 50, 0.1);
      }

      .typing-dots {
        display: flex;
        gap: 4px;
      }

      .typing-dot {
        width: 8px;
        height: 8px;
        background: var(--primary-green);
        border-radius: 50%;
        animation: typingAnimation 1.4s infinite ease-in-out;
      }

      .typing-dot:nth-child(2) {
        animation-delay: 0.2s;
      }

      .typing-dot:nth-child(3) {
        animation-delay: 0.4s;
      }

      @keyframes typingAnimation {
        0%,
        80%,
        100% {
          transform: scale(0.8);
          opacity: 0.5;
        }
        40% {
          transform: scale(1);
          opacity: 1;
        }
      }

      /* Input Area */
      .input-area {
        padding: 1.5rem 2rem 2rem;
        background: rgba(255, 255, 255, 0.8);
        backdrop-filter: blur(10px);
        border-top: 1px solid rgba(46, 125, 50, 0.1);
      }

      .input-container {
        display: flex;
        gap: 12px;
        background: white;
        padding: 12px;
        border-radius: 24px;
        border: 2px solid rgba(46, 125, 50, 0.1);
        box-shadow: var(--shadow-soft);
        transition: all 0.3s ease;
      }

      .input-container:focus-within {
        border-color: var(--primary-green);
        box-shadow: 0 0 0 4px rgba(46, 125, 50, 0.1);
      }

      #user-input {
        flex-grow: 1;
        border: none;
        background: transparent;
        padding: 8px 12px;
        font-size: 1rem;
        font-family: var(--font-secondary);
        outline: none;
        color: var(--primary-green);
      }

      #user-input::placeholder {
        color: rgba(46, 125, 50, 0.5);
      }

      .send-button {
        background: var(--user-msg-bg);
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 18px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 8px;
        font-family: var(--font-secondary);
      }

      .send-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: var(--shadow-medium);
      }

      .send-button:disabled {
        opacity: 0.6;
        cursor: not-allowed;
      }

      /* Utility Actions */
      .chat-actions {
        display: flex;
        gap: 10px;
        margin-top: 1rem;
        justify-content: center;
      }

      .action-button {
        background: rgba(46, 125, 50, 0.1);
        color: var(--primary-green);
        border: 1px solid rgba(46, 125, 50, 0.2);
        padding: 8px 16px;
        border-radius: 12px;
        cursor: pointer;
        font-size: 0.9rem;
        transition: all 0.3s ease;
        font-family: var(--font-secondary);
      }

      .action-button:hover {
        background: var(--primary-green);
        color: white;
      }

      /* Responsive Design - Enhanced Mobile Experience */
      @media (max-width: 768px) {
        body {
          padding: 60px 8px 8px;
          font-size: 16px; /* Prevent zoom on iOS */
        }

        #chat-container {
          height: calc(100vh - 80px);
          border-radius: 12px;
          margin: 0;
          box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        }

        .chat-header {
          padding: 1rem 1.5rem;
          border-radius: 12px 12px 0 0;
        }

        .header-title {
          font-size: 1.3rem;
          line-height: 1.4;
        }

        .header-subtitle {
          font-size: 0.85rem;
          margin-top: 0.25rem;
        }

        .nav-links {
          display: none;
        }

        /* Mobile hamburger menu */
        .mobile-menu-toggle {
          display: block;
          background: none;
          border: none;
          color: white;
          font-size: 1.5rem;
          cursor: pointer;
          padding: 0.5rem;
          border-radius: 4px;
        }

        .message {
          max-width: 90%;
          margin: 0.75rem 0;
          padding: 0.75rem 1rem;
          border-radius: 18px;
          font-size: 0.95rem;
          line-height: 1.4;
        }

        .user-message {
          margin-left: auto;
          margin-right: 1rem;
        }

        .bot-message {
          margin-left: 1rem;
          margin-right: auto;
        }

        #chat-history {
          padding: 1rem 0.5rem;
          height: calc(100vh - 220px);
        }

        .input-area {
          padding: 1rem;
          border-radius: 0 0 12px 12px;
        }

        .input-container {
          flex-direction: column;
          gap: 0.75rem;
        }

        #user-input {
          width: 100%;
          min-height: 44px;
          font-size: 16px; /* Prevent zoom on iOS */
          padding: 0.75rem;
          border-radius: 12px;
          border: 2px solid var(--input-border);
        }

        .input-buttons {
          display: flex;
          gap: 0.5rem;
          width: 100%;
        }

        #send-button,
        #voice-button {
          flex: 1;
          min-height: 44px;
          font-size: 0.9rem;
          padding: 0.75rem 1rem;
          border-radius: 12px;
          font-weight: 600;
        }

        /* Voice input specific mobile styles */
        .voice-indicator {
          font-size: 0.8rem;
          padding: 0.5rem;
        }

        /* Loading states for mobile */
        .typing-indicator {
          padding: 0.5rem 1rem;
          margin: 0.5rem 1rem;
        }

        /* Scroll improvements for mobile */
        #chat-history::-webkit-scrollbar {
          width: 4px;
        }

        #chat-history::-webkit-scrollbar-track {
          background: transparent;
        }

        #chat-history::-webkit-scrollbar-thumb {
          background: rgba(46, 125, 50, 0.3);
          border-radius: 2px;
        }
      }

      /* Small mobile devices (max-width: 480px) */
      @media (max-width: 480px) {
        body {
          padding: 50px 4px 4px;
        }

        #chat-container {
          height: calc(100vh - 60px);
          border-radius: 8px;
        }

        .chat-header {
          padding: 0.75rem 1rem;
        }

        .header-title {
          font-size: 1.1rem;
        }

        .header-subtitle {
          font-size: 0.8rem;
        }

        .message {
          max-width: 95%;
          padding: 0.6rem 0.8rem;
          font-size: 0.9rem;
          border-radius: 16px;
        }

        #chat-history {
          padding: 0.75rem 0.25rem;
          height: calc(100vh - 200px);
        }

        .input-area {
          padding: 0.75rem;
        }

        #user-input {
          padding: 0.6rem;
          font-size: 16px;
        }

        #send-button,
        #voice-button {
          padding: 0.6rem 0.8rem;
          font-size: 0.85rem;
        }
      }

      /* Landscape orientation on mobile */
      @media (max-width: 768px) and (orientation: landscape) {
        #chat-container {
          height: calc(100vh - 60px);
        }

        #chat-history {
          height: calc(100vh - 160px);
        }

        .chat-header {
          padding: 0.75rem 1.5rem;
        }

        .input-area {
          padding: 0.75rem 1rem;
        }
      }

      /* Touch-friendly improvements */
      @media (max-width: 768px) {
        /* Ensure all interactive elements are touch-friendly */
        button,
        input,
        textarea {
          min-height: 44px;
          min-width: 44px;
        }

        /* Improve tap targets */
        .nav-logo {
          padding: 0.5rem;
        }

        /* Prevent text selection on buttons */
        button {
          -webkit-user-select: none;
          -moz-user-select: none;
          -ms-user-select: none;
          user-select: none;
        }

        /* Smooth scrolling for mobile */
        #chat-history {
          -webkit-overflow-scrolling: touch;
          scroll-behavior: smooth;
        }

        /* Hide overflow on mobile to prevent horizontal scroll */
        body {
          overflow-x: hidden;
        }
      }

      /* Accessibility Improvements */
      @media (prefers-reduced-motion: reduce) {
        * {
          animation-duration: 0.01ms !important;
          animation-iteration-count: 1 !important;
          transition-duration: 0.01ms !important;
        }
      }

      /* Focus indicators */
      button:focus,
      input:focus {
        outline: 2px solid var(--accent-orange);
        outline-offset: 2px;
      }

      /* High contrast mode support */
      @media (prefers-contrast: high) {
        :root {
          --primary-green: #000;
          --bg-gradient: #fff;
          --chat-bg: #fff;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navigation -->
    <nav class="nav-bar">
      <div class="nav-logo">
        <i class="fas fa-seedling"></i>
        Mudhumeni AI
      </div>
      <button
        class="mobile-menu-toggle"
        onclick="toggleMobileMenu()"
        style="display: none"
      >
        <i class="fas fa-bars"></i>
      </button>
      <div class="nav-links" id="nav-links">
        <a href="/">Home</a>
        <a href="/chatbot" class="active">Chatbot</a>
        <a href="/crop-recommendation">Crop Recommendation</a>
        <a href="/recommendation-history">History</a>
        <a href="/about">About</a>
      </div>
    </nav>

    <!-- Main Chat Container -->
    <div id="chat-container">
      <!-- Header -->
      <div class="chat-header">
        <div class="bot-avatar">
          <i class="fas fa-robot"></i>
        </div>
        <div class="header-content">
          <div class="header-title">Mudhumeni AI</div>
          <div class="header-subtitle">
            Your intelligent farming companion for Southern Africa
          </div>
        </div>
        <div class="status-indicator">
          <div class="status-dot"></div>
          <span>Online</span>
        </div>
      </div>

      <!-- Chat History -->
      <div id="chat-history">
        <div class="message assistant">
          <div class="message-avatar">
            <i class="fas fa-leaf"></i>
          </div>
          <div class="message-content">
            <p><strong>Sawubona! Hello there!</strong> 🌱</p>

            <p>
              I'm <strong>Mudhumeni AI</strong>, your dedicated farming
              companion for Southern Africa. Whether you're a seasoned farmer or
              just starting your agricultural journey, I'm here to help you grow
              successfully.
            </p>

            <p>I can assist you with:</p>
            <ul>
              <li><strong>Crop selection</strong> and seasonal planning</li>
              <li><strong>Soil health</strong> and fertility management</li>
              <li>
                <strong>Pest and disease</strong> identification and control
              </li>
              <li><strong>Weather patterns</strong> and climate adaptation</li>
              <li><strong>Sustainable farming</strong> practices</li>
              <li><strong>Market insights</strong> and crop timing</li>
            </ul>

            <p>
              What farming questions or challenges can I help you with today? 🚜
            </p>
          </div>
        </div>
      </div>

      <!-- Typing Indicator -->
      <div class="typing-indicator" id="typing-indicator">
        <div class="message-avatar">
          <i class="fas fa-leaf"></i>
        </div>
        <div class="typing-content">
          <span>Mudhumeni is thinking</span>
          <div class="typing-dots">
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
            <div class="typing-dot"></div>
          </div>
        </div>
      </div>

      <!-- Input Area -->
      <div class="input-area">
        <form id="chat-form">
          <div class="input-container">
            <input
              type="text"
              id="user-input"
              placeholder="Ask me about farming, crops, soil, weather, or any agricultural challenge..."
              autocomplete="off"
              aria-label="Type your farming question here"
            />
            <button type="submit" class="send-button" id="send-btn">
              <i class="fas fa-paper-plane"></i>
              Send
            </button>
          </div>
        </form>

        <div class="chat-actions">
          <button class="action-button" onclick="clearChat()">
            <i class="fas fa-broom"></i> Clear Chat
          </button>
          <button class="action-button" onclick="showQuickHelp()">
            <i class="fas fa-question-circle"></i> Quick Help
          </button>
        </div>
      </div>
    </div>

    <script>
      // Enhanced JavaScript with better UX features
      $(document).ready(function () {
        // Configure marked for better markdown rendering
        marked.setOptions({
          breaks: true,
          gfm: true,
        });

        function createMessage(content, role) {
          const avatar =
            role === "user"
              ? '<i class="fas fa-user"></i>'
              : '<i class="fas fa-leaf"></i>';

          // Parse markdown for assistant messages
          const formattedContent =
            role === "assistant" ? marked.parse(content) : content;

          return `
                    <div class="message ${role}">
                        <div class="message-avatar">${avatar}</div>
                        <div class="message-content">${formattedContent}</div>
                    </div>
                `;
        }

        function scrollToBottom() {
          const chatHistory = document.getElementById("chat-history");
          chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function showTypingIndicator() {
          $("#typing-indicator").show();
          scrollToBottom();
        }

        function hideTypingIndicator() {
          $("#typing-indicator").hide();
        }

        function enableInput() {
          $("#user-input").prop("disabled", false).focus();
          $("#send-btn").prop("disabled", false);
        }

        function disableInput() {
          $("#user-input").prop("disabled", true);
          $("#send-btn").prop("disabled", true);
        }

        // Handle form submission
        $("#chat-form").on("submit", function (e) {
          e.preventDefault();
          const userInput = $("#user-input").val().trim();

          if (!userInput) return;

          // Add user message
          $("#chat-history").append(createMessage(userInput, "user"));
          $("#user-input").val("");

          // Disable input and show typing indicator
          disableInput();
          showTypingIndicator();
          scrollToBottom();

          // Send request to backend
          $.ajax({
            url: "/get_response",
            type: "POST",
            data: { user_input: userInput },
            timeout: 30000, // 30 second timeout
            success: function (response) {
              hideTypingIndicator();
              $("#chat-history").append(
                createMessage(response.response, "assistant")
              );
              scrollToBottom();
            },
            error: function (xhr, status, error) {
              hideTypingIndicator();
              let errorMessage =
                "I apologize, but I encountered an error. Please try again.";

              if (status === "timeout") {
                errorMessage =
                  "The request timed out. Please check your connection and try again.";
              } else if (xhr.status === 0) {
                errorMessage =
                  "Unable to connect. Please check your internet connection.";
              }

              $("#chat-history").append(
                createMessage(errorMessage, "assistant")
              );
              scrollToBottom();
            },
            complete: function () {
              enableInput();
            },
          });
        });

        // Enhanced keyboard navigation
        $("#user-input").on("keydown", function (e) {
          if (e.key === "Enter" && !e.shiftKey) {
            e.preventDefault();
            $("#chat-form").submit();
          }
        });

        // Auto-resize textarea behavior
        $("#user-input").on("input", function () {
          this.style.height = "auto";
          this.style.height = this.scrollHeight + "px";
        });

        // Focus input on page load
        $("#user-input").focus();

        // Add some loading states and animations
        $(document)
          .ajaxStart(function () {
            $(".status-dot").css("background", "#FFC107");
          })
          .ajaxStop(function () {
            $(".status-dot").css("background", "#4CAF50");
          });
      });

      // Utility Functions
      function clearChat() {
        if (confirm("Are you sure you want to clear the chat history?")) {
          $.post("/clear_history", function () {
            $("#chat-history").empty().append(`
                        <div class="message assistant">
                            <div class="message-avatar">
                                <i class="fas fa-leaf"></i>
                            </div>
                            <div class="message-content">
                                <p><strong>Chat cleared!</strong> 🌱</p>
                                <p>How can I help you with your farming needs today?</p>
                            </div>
                        </div>
                    `);
          });
        }
      }

      function showQuickHelp() {
        const helpMessage = `
                <div class="message assistant">
                    <div class="message-avatar">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    <div class="message-content">
                        <h3>🌱 Quick Help Guide</h3>
                        
                        <p><strong>Sample questions you can ask:</strong></p>
                        
                        <ul>
                            <li>"What crops should I plant this season?"</li>
                            <li>"How do I improve my soil pH?"</li>
                            <li>"What are signs of nutrient deficiency in maize?"</li>
                            <li>"Best irrigation practices for drought conditions"</li>
                            <li>"How to control aphids naturally?"</li>
                            <li>"When is the best time to harvest tobacco?"</li>
                        </ul>
                        
                        <p><strong>Tips for better responses:</strong></p>
                        <ul>
                            <li>Mention your location (province/country)</li>
                            <li>Specify your crop type and farm size</li>
                            <li>Describe your current challenges in detail</li>
                            <li>Ask follow-up questions for clarification</li>
                        </ul>
                        
                        <p>I'm here to help make your farming more successful and sustainable! 🚜</p>
                    </div>
                </div>
            `;

        $("#chat-history").append(helpMessage);
        document.getElementById("chat-history").scrollTop =
          document.getElementById("chat-history").scrollHeight;
      }

      // Add some nice entrance animations
      $(window).on("load", function () {
        $("#chat-container").css("opacity", "0").animate({ opacity: 1 }, 800);
      });

      // Mobile navigation toggle functionality
      function toggleMobileMenu() {
        const navLinks = document.getElementById("nav-links");
        const toggleButton = document.querySelector(".mobile-menu-toggle i");

        if (
          navLinks.style.display === "none" ||
          navLinks.style.display === ""
        ) {
          navLinks.style.display = "flex";
          navLinks.style.flexDirection = "column";
          navLinks.style.position = "absolute";
          navLinks.style.top = "100%";
          navLinks.style.left = "0";
          navLinks.style.right = "0";
          navLinks.style.background = "rgba(255, 255, 255, 0.95)";
          navLinks.style.borderRadius = "0 0 8px 8px";
          navLinks.style.boxShadow = "0 4px 12px rgba(0, 0, 0, 0.15)";
          navLinks.style.padding = "1rem";
          navLinks.style.zIndex = "1000";
          toggleButton.className = "fas fa-times";
        } else {
          navLinks.style.display = "none";
          toggleButton.className = "fas fa-bars";
        }
      }

      // Show mobile menu toggle on small screens
      function checkScreenSize() {
        const mobileToggle = document.querySelector(".mobile-menu-toggle");
        const navLinks = document.getElementById("nav-links");

        if (window.innerWidth <= 768) {
          mobileToggle.style.display = "block";
          if (navLinks.style.display !== "flex") {
            navLinks.style.display = "none";
          }
        } else {
          mobileToggle.style.display = "none";
          navLinks.style.display = "flex";
          navLinks.style.position = "static";
          navLinks.style.flexDirection = "row";
          navLinks.style.background = "none";
          navLinks.style.boxShadow = "none";
          navLinks.style.padding = "0";
        }
      }

      // Initialize on page load
      document.addEventListener("DOMContentLoaded", checkScreenSize);
      window.addEventListener("resize", checkScreenSize);

      // Mobile-specific optimizations
      if ("ontouchstart" in window) {
        // Add touch feedback for better mobile experience
        document.addEventListener("touchstart", function (e) {
          if (
            e.target.classList.contains("btn") ||
            e.target.tagName === "BUTTON"
          ) {
            e.target.style.transform = "scale(0.98)";
            setTimeout(() => {
              e.target.style.transform = "scale(1)";
            }, 150);
          }
        });

        // Optimize chat scrolling for mobile
        const chatHistory = document.getElementById("chat-history");
        if (chatHistory) {
          chatHistory.style.webkitOverflowScrolling = "touch";
          chatHistory.style.scrollBehavior = "smooth";
        }

        // Prevent zoom on input focus for iOS
        const inputs = document.querySelectorAll("input, textarea");
        inputs.forEach((input) => {
          input.addEventListener("focus", function () {
            if (window.innerWidth <= 768) {
              const viewport = document.querySelector('meta[name="viewport"]');
              viewport.content =
                "width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no";

              setTimeout(() => {
                viewport.content = "width=device-width, initial-scale=1.0";
              }, 500);
            }
          });
        });
      }
    </script>
  </body>
</html>
